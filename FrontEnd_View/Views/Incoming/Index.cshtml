@model IEnumerable<BackendAPI.Models.Vendor>

<script src="~/js/jquery-3.7.1.min.js"></script>

@{
    ViewData["Title"] = "Index";
}

<style>
    .required:after {
        content: " *";
        color: red;
    }
</style>

<h1>Vendor</h1>

<div style="display:flex;flex-direction: row-reverse;margin-top:-30px;margin-bottom:15px">
    <button type="button" id="save" class="btn btn-primary">NEW</button>
</div>
<div style="overflow-x: auto;">
<table class="table" id="assignTable">
    <thead>
        <tr>
            <th>
                Name
            </th>
            <th>
                Phone
            </th>
            <th>
                Email
            </th>

            <th></th>
        </tr>
    </thead>
    <tbody>
        @foreach (var item in Model)
        {
            <tr>
                <td>
                    @item.Name
                </td>
                <td>
                    @item.Phone
                </td>
                <td>
                    @item.Email
                </td>
                <td>
                    <a href="javascript:void(0);" onclick="editCategoryModals('@item.Id','@item.Name','@item.Phone','@item.Email')">Edit</a>  |
                    <a href="javascript:void(0);" onclick="deleteVendor(@item.Id)">Delete</a>
                </td>
            </tr>
        }
    </tbody>
</table>

</div>
<!-- Modal aDD Vendor -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Add Vendor</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="row" style="padding-bottom:10px">
                    <div class="col-md-4">
                        <label for="inputname" class="form-label required">Name</label>
                        <input type="text" class="form-control" id="inputname">
                    </div>
                    <div class="col-md-4">
                        <label for="inputname" class="form-label">Phone</label>
                        <input type="number" class="form-control" id="inputphone">
                    </div>
                    <div class="col-md-6">
                        <label for="inputname" class="form-label">Email</label>
                        <input type="text" class="form-control" id="inputemail">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" onclick="AddVendor()" class="btn btn-primary">ADD</button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal Editing Vendor -->
<div class="modal fade" id="editVendorModal" tabindex="-1" role="dialog" aria-labelledby="editCategoryModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editCategoryModalLabel">Edit Vendor</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="col-md-6">
                    <label for="editCategoryName" class="form-label">Name</label>
                    <input type="text" class="form-control" id="editname">
                    <input style="display:none" type="text" class="form-control" id="editId">
                </div>
                <div class="col-md-6">
                    <label for="inputname" class="form-label">Email</label>
                    <input type="text" class="form-control" id="editemail">
                </div>
                <div class="col-md-6">
                    <label for="inputname" class="form-label">Phone</label>
                    <input type="text" class="form-control" id="editphone">
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" onclick="updateVendor()" class="btn btn-primary">Update</button>
            </div>
        </div>
    </div>
</div>

<script>
    $(document).ready(function () {
        $('#assignTable').DataTable();
        $("#save").click(function () {
            $("#myModal").modal("show");
        });
    });


    function AddVendor() {

        

        var nameValue = $("#inputname").val();
        var phoneValue = $("#inputphone").val();
        var emailValue = $("#inputemail").val();

        if (nameValue == "") { alert("kinldy fill mandatory fields") }
        else {
            $.ajax({
                url: '/Incoming/VendorAdd',
                type: 'POST',
                data: { Name: nameValue, Email: emailValue, Phone: phoneValue },
                success: function (data) {
                    if (data.success) {
                        Swal.fire({
                            icon: "success",
                            title: "Vendor Added",
                            showConfirmButton: false,
                            timer: 1500
                        });
                        setTimeout(() => {
                            location.reload();
                        }, 1300);

                    } else {
                        alert("Failed to add vendor. Please try again.");
                    }
                },
                error: function () {
                    alert("Failed to add vendor. Please try again.");
                }
            });
        }
    }

    $('.modal .close').on('click', function () {
        // Trigger the close event for the modal that contains the clicked close button
        $(this).closest('.modal').modal('hide');
    });

    function editCategoryModals(id,name,phone,email) {
        $('#editId').val(id);
        $('#editname').val(name);
        $('#editemail').val(email);
        $('#editphone').val(phone);
        $("#editVendorModal").modal("show");
    }

    function updateVendor() {

        var nameValue = $("#editname").val();
        var emailValue = $('#editemail').val();
        var phoneValue = $('#editphone').val();
        var idValue = $('#editId').val();

        if (nameValue == "") { alert("kinldy fill mandatory fields") }
        else {

            $.ajax({
                url: '/Incoming/VendorEdit',
                type: 'POST',
                data: { Id: idValue, Name: nameValue, Email: emailValue, Phone: phoneValue },
                success: function (data) {
                    if (data.success) {
                        Swal.fire({
                            icon: "success",
                            title: "Vendor Updated",
                            showConfirmButton: false,
                            timer: 1500
                        });
                        setTimeout(() => {
                            location.reload();
                        }, 1300);

                    } else {
                        alert("Failed to update vendor. Please try again.");
                    }
                },
                error: function () {
                    alert("Failed to update vendor. Please try again.");
                }
            });
        }
    }

    function deleteVendor(id) {
        if (confirm("Are you sure you want to delete this category?")) {
            $.ajax({
                url: '/Incoming/VendorDelete',
                type: 'POST',
                data: { Id: id },
                success: function (data) {
                    if (data.success) {
                        Swal.fire({
                            icon: "success",
                            title: "Vendor Deleted",
                            showConfirmButton: false,
                            timer: 1500
                        });
                        setTimeout(() => {
                            location.reload();
                        }, 1300);

                    } else {
                        alert("Failed to delete vendor. Please try again.");
                    }
                },
                error: function () {
                    alert("Failed to delete vendor. Please try again.");
                }
            });
        }
    }


</script>